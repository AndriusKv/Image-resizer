{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _mainJs = require(\"./main.js\");\n\nvar progressBar = document.getElementById(\"js-progress\"),\n    processBtn = document.getElementById(\"js-process\"),\n    downloadBtn = document.getElementById(\"js-download\"),\n    cancelBtn = document.getElementById(\"js-cancel\"),\n    isCanceled = false,\n    isWorking = false;\n\nfunction setProgressLabel(text) {\n    requestAnimationFrame(function () {\n        document.getElementById(\"js-progress-label\").textContent = text;\n    });\n}\n\nfunction updateProgress(value) {\n    progressBar.value += value;\n}\n\nfunction resetProgress() {\n    progressBar.value = 0;\n}\n\nfunction isDone() {\n    return Math.round(progressBar.value) === 100;\n}\n\nfunction removeMasksAndLabel() {\n    setProgressLabel(\"\");\n    (0, _mainJs.removeMasks)();\n}\n\nfunction beforeWork() {\n    (0, _mainJs.addMasks)();\n    exports.isWorking = isWorking = true;\n    (0, _mainJs.showElement)(progressBar);\n    (0, _mainJs.hideElement)(processBtn);\n    (0, _mainJs.showElement)(cancelBtn);\n}\n\nfunction resetDropbox() {\n    exports.isWorking = isWorking = false;\n    (0, _mainJs.hideElement)(progressBar);\n    (0, _mainJs.hideElement)(cancelBtn);\n    resetProgress();\n    removeMasksAndLabel();\n}\n\nexports.isDone = isDone;\nexports.cancelBtn = cancelBtn;\nexports.isWorking = isWorking;\nexports.beforeWork = beforeWork;\nexports.isCanceled = isCanceled;\nexports.processBtn = processBtn;\nexports.progressBar = progressBar;\nexports.downloadBtn = downloadBtn;\nexports.resetDropbox = resetDropbox;\nexports.resetProgress = resetProgress;\nexports.updateProgress = updateProgress;\nexports.setProgressLabel = setProgressLabel;\nexports.removeMasksAndLabel = removeMasksAndLabel;\n},{\"./main.js\":2}],2:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nrequire(\"./dropbox.js\");\n\nrequire(\"./selections.js\");\n\nrequire(\"./read.js\");\n\nrequire(\"./process.js\");\n\nvar dropboxLabel = document.getElementById(\"js-dropbox-label\"),\n    settingsMask = document.getElementById(\"js-selections-mask\"),\n    timeout;\n\nfunction addClass(target, classToAdd) {\n    var targetClassList = target.classList;\n\n    if (!targetClassList.contains(classToAdd)) {\n        targetClassList.add(classToAdd);\n    }\n}\n\nfunction removeClass(target, classToRemove) {\n    var targetClassList = target.classList;\n\n    if (targetClassList.contains(classToRemove)) {\n        targetClassList.remove(classToRemove);\n    }\n}\n\nfunction showElement(element) {\n    addClass(element, \"show\");\n}\n\nfunction hideElement(element) {\n    removeClass(element, \"show\");\n}\n\nfunction addMasks() {\n    addClass(dropboxLabel, \"mask\");\n    addClass(settingsMask, \"mask\");\n}\n\nfunction removeMasks() {\n    removeClass(dropboxLabel, \"mask\");\n    removeClass(settingsMask, \"mask\");\n}\n\nfunction hideMessageAfter(delay) {\n    if (timeout) {\n        clearTimeout(timeout);\n    }\n\n    timeout = setTimeout(function () {\n        showMessage(\"\");\n    }, delay);\n}\n\nfunction showMessage(message) {\n    requestAnimationFrame(function () {\n        document.getElementById(\"js-msg\").innerHTML = message;\n    });\n\n    if (!message) {\n        return;\n    }\n\n    hideMessageAfter(2000);\n}\n\nexports.addMasks = addMasks;\nexports.removeMasks = removeMasks;\nexports.addClass = addClass;\nexports.removeClass = removeClass;\nexports.showElement = showElement;\nexports.hideElement = hideElement;\nexports.showMessage = showMessage;\n},{\"./dropbox.js\":1,\"./process.js\":3,\"./read.js\":4,\"./selections.js\":5}],3:[function(require,module,exports){\n/* global saveAs */\n\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj[\"default\"] = obj; return newObj; } }\n\nvar _selectionsJs = require(\"./selections.js\");\n\nvar select = _interopRequireWildcard(_selectionsJs);\n\nvar _dropboxJs = require(\"./dropbox.js\");\n\nvar dropbox = _interopRequireWildcard(_dropboxJs);\n\nvar _mainJs = require(\"./main.js\");\n\nvar images = [],\n    worker,\n    zip;\n\nfunction showMessageWithButton(message, button) {\n    (0, _mainJs.showMessage)(message);\n    (0, _mainJs.showElement)(button);\n}\n\nfunction initWorker() {\n    if (!worker) {\n        exports.worker = worker = new Worker(\"js/workers/worker1.js\");\n\n        worker.onmessage = function (event) {\n            exports.zip = zip = event.data;\n            dropbox.isWorking = false;\n            dropbox.removeMasksAndLabel();\n            showMessageWithButton(\"Images are ready for downloading.\", dropbox.downloadBtn);\n            worker.postMessage({ action: \"remove\" });\n        };\n        worker.onerror = function (event) {\n            console.log(event);\n        };\n    }\n}\n\nfunction saveZip(data) {\n    try {\n        saveAs(data, \"images.zip\");\n    } catch (error) {\n        var script = document.createElement(\"script\");\n\n        script.setAttribute(\"src\", \"js/libs/FileSaver.min.js\");\n\n        document.getElementsByTagName(\"body\")[0].appendChild(script);\n\n        script.onload = function () {\n            saveZip(data);\n        };\n    }\n}\n\nfunction getDimensionsWithoutRatio(_ref) {\n    var width = _ref.width;\n    var height = _ref.height;\n\n    if (width && !height) {\n        height = width;\n    } else if (!width && height) {\n        width = height;\n    }\n\n    return { width: width, height: height };\n}\n\nfunction getDimensionsWithRatio(_ref2, ratio) {\n    var width = _ref2.width;\n    var height = _ref2.height;\n\n    if (width) {\n        height = width / ratio;\n    } else if (height) {\n        width = height * ratio;\n    }\n\n    return { width: width, height: height };\n}\n\nfunction getUri(image, type, _ref3) {\n    var width = _ref3.width;\n    var height = _ref3.height;\n\n    var canvas = document.createElement(\"canvas\");\n\n    canvas.width = width;\n    canvas.height = height;\n    canvas.getContext(\"2d\").drawImage(image, 0, 0, width, height);\n\n    return canvas.toDataURL(type);\n}\n\nfunction generateZip() {\n    dropbox.setProgressLabel(\"Generating Archive\");\n    worker.postMessage({ action: \"generate\" });\n}\n\nfunction doneResizing() {\n    setTimeout(function () {\n        if (dropbox.isCanceled) {\n            return;\n        }\n\n        (0, _mainJs.hideElement)(dropbox.progressBar);\n        (0, _mainJs.hideElement)(dropbox.cancelBtn);\n        dropbox.resetProgress();\n        generateZip();\n    }, 1000);\n}\n\nfunction resizeImage(image, imageToResize, inc) {\n    return function resize(dimensions) {\n        var dimension = dimensions.splice(0, 1)[0];\n\n        dropbox.updateProgress(inc);\n\n        worker.postMessage({\n            action: \"add\",\n            image: {\n                name: imageToResize.name,\n                uri: getUri(image, imageToResize.type, dimension),\n                type: imageToResize.type.slice(6)\n            }\n        });\n\n        if (dropbox.isDone()) {\n            doneResizing();\n        }\n\n        if (dimensions.length) {\n            var delay = imageToResize.size * dimension.width * dimension.height / 2000 + 100;\n\n            setTimeout(function () {\n                if (dropbox.isCanceled) {\n                    return;\n                }\n\n                resize(dimensions);\n            }, delay);\n        }\n    };\n}\n\nfunction processImage(images, dimensions) {\n    var inc = 100 / (images.length * dimensions.length);\n\n    return function process(cb) {\n        var image = new Image(),\n            imageToResize = images.splice(0, 1)[0];\n\n        image.onload = function () {\n            var ratio = image.width / image.height,\n                adjustedDimensions = dimensions.map(function (dimension) {\n                return cb(dimension, ratio);\n            }),\n                resize = resizeImage(image, imageToResize, inc);\n\n            if (dropbox.isCanceled) {\n                return;\n            }\n\n            dropbox.setProgressLabel(\"Processing: \" + imageToResize.name);\n            resize(adjustedDimensions);\n        };\n        image.src = imageToResize.uri;\n\n        if (images.length) {\n            var delay = imageToResize.size * 400 + 100;\n\n            setTimeout(function () {\n                if (dropbox.isCanceled) {\n                    return;\n                }\n\n                process(cb);\n            }, delay);\n        }\n    };\n}\n\nfunction inputsValid() {\n    var widths = select.widthInputCointaner.children,\n        heights = select.heightInputContainer.children;\n\n    if (!select.hasValue(widths) && !select.hasValue(heights)) {\n        showMessageWithButton(\"No dimensions specified.\", dropbox.processBtn);\n        return false;\n    }\n\n    var isValidWidth = select.isValid(widths),\n        isValidHeight = select.isValid(heights);\n\n    if (!isValidWidth || !isValidHeight) {\n        showMessageWithButton(\"Only numbers allowed.\", dropbox.processBtn);\n        return false;\n    }\n\n    return true;\n}\n\nfunction getDimensions() {\n    var widths = select.widthInputCointaner.children,\n        heights = select.heightInputContainer.children,\n        dimensions = [];\n\n    for (var i = 0, l = widths.length; i < l; i++) {\n        var width = Number.parseInt(widths[i].value, 10),\n            height = Number.parseInt(heights[i].value, 10);\n\n        if (width || height) {\n            dimensions.push({ width: width, height: height });\n        }\n    }\n\n    return dimensions;\n}\n\nfunction processImages() {\n    if (!inputsValid()) {\n        dropbox.resetDropbox();\n        return;\n    }\n\n    initWorker();\n    dropbox.beforeWork();\n\n    var dimensions = getDimensions(),\n        process = processImage(images, dimensions);\n\n    if (select.checkbox.checked) {\n        process(getDimensionsWithRatio);\n    } else {\n        process(getDimensionsWithoutRatio);\n    }\n\n    select.saveToLocalStorage();\n}\n\nfunction downloadImages() {\n    saveZip(zip);\n}\n\nfunction cancelWork() {\n    dropbox.isCanceled = true;\n    exports.zip = zip = null;\n    images.length = 0;\n    dropbox.resetDropbox();\n    (0, _mainJs.showMessage)(\"Work canceled.\");\n}\n\ndropbox.processBtn.addEventListener(\"click\", processImages, false);\ndropbox.downloadBtn.addEventListener(\"click\", downloadImages, false);\ndropbox.cancelBtn.addEventListener(\"click\", cancelWork, false);\n\nexports.zip = zip;\nexports.images = images;\nexports.worker = worker;\nexports.processImages = processImages;\n},{\"./dropbox.js\":1,\"./main.js\":2,\"./selections.js\":5}],4:[function(require,module,exports){\n\"use strict\";\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj[\"default\"] = obj; return newObj; } }\n\nvar _mainJs = require(\"./main.js\");\n\nvar _dropboxJs = require(\"./dropbox.js\");\n\nvar dropbox = _interopRequireWildcard(_dropboxJs);\n\nvar _processJs = require(\"./process.js\");\n\nvar process = _interopRequireWildcard(_processJs);\n\nvar dropboxElement = document.getElementById(\"js-dropbox\"),\n    counter = 0;\n\nfunction doneReadingFiles() {\n    setTimeout(function () {\n        if (dropbox.isCanceled) {\n            return;\n        }\n\n        if (process.images.length) {\n            dropbox.resetProgress();\n            process.processImages();\n        } else {\n            dropbox.resetDropbox();\n            (0, _mainJs.showMessage)(\"No images to process.\");\n        }\n    }, 1200);\n}\n\nfunction isImage(type) {\n    return type.includes(\"image\");\n}\n\nfunction readImage(image) {\n    var reader = new FileReader();\n\n    reader.readAsDataURL(image);\n    reader.onloadend = function (event) {\n        process.images.push({\n            name: image.name,\n            type: image.type,\n            size: image.size / 1e6,\n            uri: event.target.result\n        });\n    };\n}\n\nfunction readFiles(files, inc) {\n    var file = files[0];\n\n    dropbox.setProgressLabel(\"Reading: \" + file.name);\n    files = Array.prototype.slice.call(files, 1);\n\n    if (isImage(file.type)) {\n        readImage(file);\n    }\n\n    dropbox.updateProgress(inc);\n\n    if (!files.length) {\n        doneReadingFiles();\n    }\n\n    if (files.length) {\n        var delay = file.size / 1e6 * 100 + 100;\n\n        setTimeout(function () {\n            if (dropbox.isCanceled) {\n                return;\n            }\n\n            readFiles(files, inc);\n        }, delay);\n    }\n}\n\nfunction onFiles(files) {\n    var inc = 100 / files.length;\n\n    if (process.worker) {\n        process.worker.postMessage({ action: \"remove\" });\n    }\n\n    process.zip = null;\n    dropbox.isCanceled = false;\n    (0, _mainJs.hideElement)(dropbox.downloadBtn);\n    dropbox.beforeWork();\n    readFiles(files, inc);\n}\n\nfunction onUpload(event) {\n    var files = event.target.files;\n\n    event.preventDefault();\n\n    if (files.length) {\n        onFiles(files);\n    }\n}\n\nfunction onDrop(event) {\n    counter = 0;\n    (0, _mainJs.removeClass)(event.target, \"over\");\n\n    event.stopPropagation();\n    event.preventDefault();\n\n    if (dropbox.isWorking) {\n        event.dataTransfer.dropEffect = \"none\";\n        return;\n    }\n\n    event.dataTransfer.dropEffect = \"copy\";\n    onFiles(event.dataTransfer.files);\n}\n\nfunction onDragover(event) {\n    event.stopPropagation();\n    event.preventDefault();\n}\n\nfunction onDragenter(event) {\n    event.preventDefault();\n\n    if (dropbox.isWorking) {\n        return;\n    }\n\n    counter += 1;\n    (0, _mainJs.addClass)(event.target, \"over\");\n}\n\nfunction onDragleave(event) {\n    if (dropbox.isWorking) {\n        return;\n    }\n\n    counter -= 1;\n\n    if (!counter) {\n        (0, _mainJs.removeClass)(event.target, \"over\");\n    }\n}\n\ndocument.getElementById(\"js-image-select\").addEventListener(\"change\", onUpload, false);\ndropboxElement.addEventListener(\"dragover\", onDragover, false);\ndropboxElement.addEventListener(\"dragenter\", onDragenter, false);\ndropboxElement.addEventListener(\"dragleave\", onDragleave, false);\ndropboxElement.addEventListener(\"drop\", onDrop, false);\ndropboxElement.addEventListener(\"click\", function (event) {\n    if (dropbox.isWorking) {\n        event.preventDefault();\n    }\n});\n},{\"./dropbox.js\":1,\"./main.js\":2,\"./process.js\":3}],5:[function(require,module,exports){\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _mainJs = require(\"./main.js\");\n\nvar widthInputCointaner = document.getElementById(\"js-width-input-container\"),\n    heightInputContainer = document.getElementById(\"js-height-input-container\"),\n    checkbox = document.getElementById(\"js-checkbox\"),\n    select = document.getElementById(\"js-select\");\n\n(function loadFromLocalStorage() {\n    var selections = localStorage.getItem(\"Selections\");\n\n    if (!selections) {\n        return;\n    }\n\n    selections = JSON.parse(selections);\n\n    checkbox.checked = selections.checked;\n    select.value = selections.numberOfInputs;\n\n    appendInputs(widthInputCointaner, selections.numberOfInputs);\n    appendInputs(heightInputContainer, selections.numberOfInputs);\n\n    assignValuesToInputs(widthInputCointaner.children, selections.widthInputValues);\n    assignValuesToInputs(heightInputContainer.children, selections.heightInputValues);\n})();\n\nfunction saveToLocalStorage() {\n    var selections = {\n        numberOfInputs: select.value,\n        checked: checkbox.checked,\n        widthInputValues: getInputValues(widthInputCointaner.children),\n        heightInputValues: getInputValues(heightInputContainer.children)\n    };\n\n    localStorage.setItem(\"Selections\", JSON.stringify(selections));\n}\n\nfunction indicateInput(input) {\n    (0, _mainJs.addClass)(input, \"invalid\");\n\n    setTimeout(function () {\n        (0, _mainJs.removeClass)(input, \"invalid\");\n    }, 400);\n}\n\nfunction isValid(inputs) {\n    var valid = true;\n\n    Array.prototype.forEach.call(inputs, function (input) {\n        if (/\\D/g.test(input.value)) {\n            indicateInput(input);\n            valid = false;\n        }\n    });\n\n    return valid;\n}\n\nfunction hasValue(inputs) {\n    return Array.prototype.some.call(inputs, function (input) {\n        return input.value;\n    });\n}\n\nfunction assignValuesToInputs(inputs, values) {\n    Array.prototype.forEach.call(inputs, function (input, index) {\n        input.value = values[index];\n    });\n}\n\nfunction getInputValues(inputs) {\n    return Array.prototype.map.call(inputs, function (input) {\n        return input.value;\n    });\n}\n\nfunction createInput() {\n    var input = document.createElement(\"input\");\n\n    input.setAttribute(\"type\", \"text\");\n    input.classList.add(\"image-input\");\n\n    return input;\n}\n\nfunction createInputs(num) {\n    var fragment = document.createDocumentFragment();\n\n    for (var i = 0; i < num; i++) {\n        fragment.appendChild(createInput());\n    }\n\n    return fragment;\n}\n\nfunction appendInputs(element, num) {\n    var totalChildren = element.children.length;\n\n    if (totalChildren < num) {\n        var toAppend = num - totalChildren;\n\n        element.appendChild(createInputs(toAppend));\n    } else {\n        var toRemove = totalChildren - num;\n\n        while (toRemove--) {\n            totalChildren = element.children.length;\n            element.removeChild(element.children[totalChildren - 1]);\n        }\n    }\n}\n\nfunction onSelection(event) {\n    var numberOfInputs = Number.parseInt(event.target.value, 10);\n\n    appendInputs(widthInputCointaner, numberOfInputs);\n    appendInputs(heightInputContainer, numberOfInputs);\n}\n\nselect.addEventListener(\"input\", onSelection, false);\n\nexports.widthInputCointaner = widthInputCointaner;\nexports.heightInputContainer = heightInputContainer;\nexports.saveToLocalStorage = saveToLocalStorage;\nexports.hasValue = hasValue;\nexports.isValid = isValid;\nexports.checkbox = checkbox;\n},{\"./main.js\":2}]},{},[2]);\n"],"file":"main.js","sourceRoot":"/source/"}